env:
    APPLICATION_ENV: docker

command-timeout: 7200

stores:
    - DE
    - AT
    - US

sections:

    scheduler-clean:
        scheduler-clean:
            command: "vendor/bin/console scheduler:clean -vvv --no-ansi || true"
            stores: true

    clean-storage:
        clean-storage:
            command: "vendor/bin/console storage:delete -vvv --no-ansi"
            stores: true

        clean-search:
            command: "vendor/bin/console elasticsearch:index:delete -vvv --no-ansi"
            stores: true

        clean-db:
            command: "vendor/bin/console propel:tables:drop -vvv --no-ansi"
            stores:
                - DE

    init-storage:
        setup-search-create-sources:
            command: "vendor/bin/console search:setup:sources -vvv --no-ansi"
            stores: true

#        setup-virtual-hosts:
#            command: "vendor/bin/console rabbitmq:virtual-hosts:init -vvv --no-ansi"

    init-storages-per-region:
        propel-copy-schema:
            command: "vendor/bin/console propel:schema:copy -vvv --no-ansi"

# We use MariaDB at the moment
#        propel-postgres-compatibility:
#            command: "vendor/bin/console propel:pg-sql-compat -vvv --no-ansi"

        propel-migration-delete:
            command: "vendor/bin/console propel:migration:delete -vvv --no-ansi"

        propel-tables-drop:
            command: "vendor/bin/console propel:tables:drop -vvv --no-ansi"
            stores:
                - DE

        propel-diff:
            command: "vendor/bin/console propel:diff -vvv --no-ansi"

        propel-migrate:
            command: "vendor/bin/console propel:migrate -vvv --no-ansi"
            stores:
                - DE

        propel-migration-cleanup:
            command: "vendor/bin/console propel:migration:delete -vvv --no-ansi"

        init-database:
            command: "vendor/bin/console setup:init-db -vvv --no-ansi"
            stores:
                - DE

    demodata:
        import-commerce-setup:
            command: "vendor/bin/console data:import --config=data/import/config/commerce_setup_import_config.development.yml -vvv --no-ansi || true"
            stores:
                - DE

        import-catalog-setup:
            command: "vendor/bin/console data:import --config=data/import/config/catalog_setup_import_config.yml -vvv --no-ansi || true"
            stores:
                - DE

        import-special-product-types-setup:
            command: "vendor/bin/console data:import --config=data/import/config/special_product_types_import_config.yml -vvv --no-ansi || true"
            stores:
                - DE

        import-merchandising-setup:
            command: "vendor/bin/console data:import --config=data/import/config/merchandising_import_config.yml -vvv --no-ansi || true"
            stores:
                - DE

        import-content-management-setup:
            command: "vendor/bin/console data:import --config=data/import/config/content_management_import_config.yml -vvv --no-ansi || true"
            stores:
                - DE

        import-b2b-setup:
            command: "vendor/bin/console data:import --config=data/import/config/b2b_setup_import_config.yml -vvv --no-ansi || true"
            stores:
                - DE

        import-marketplace-setup:
            command: "vendor/bin/console data:import --config=data/import/config/marketplace_import_config.yml -vvv --no-ansi || true"
            stores:
                - DE

        import-miscellaneous-setup:
            command: "vendor/bin/console data:import --config=data/import/config/miscellaneous_import_config.yml -vvv --no-ansi || true"
            stores:
                - DE

        update-product-labels:
            command: "vendor/bin/console product-label:relations:update -vvv --no-ansi"
            stores:
                - DE

        check-product-validity:
            command: "vendor/bin/console product:check-validity"
            stores: true

    scheduler-start:
        scheduler-setup:
            command: "vendor/bin/console scheduler:setup -vvv --no-ansi || true"
            stores: true
